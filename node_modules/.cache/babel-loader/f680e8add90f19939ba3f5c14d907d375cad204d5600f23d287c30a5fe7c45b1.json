{"ast":null,"code":"var _jsxFileName = \"/Users/ryanmorrison/Code/narrativeforge/src/components/ScenarioBuilder.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { RefreshCw } from 'lucide-react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ScenarioBuilder = ({\n  onSave,\n  initialData,\n  geminiService\n}) => {\n  _s();\n  const [scenarioData, setScenarioData] = useState(initialData || {\n    title: '',\n    setting: {\n      location: '',\n      time: '',\n      atmosphere: ''\n    },\n    initialSituation: '',\n    otherCharacters: [],\n    narrativeGoals: '',\n    toneAndThemes: ''\n  });\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  // Generate random scenario using Gemini\n  const generateRandomScenario = async () => {\n    try {\n      // Show loading state\n      setIsGenerating(true);\n\n      // If we have Gemini service, use it\n      if (geminiService) {\n        const prompt = `Create a detailed roleplay scenario with the following information:\n        - Title (creative and evocative)\n        - Setting (including location, time period, and atmosphere)\n        - Initial situation (the starting point for the roleplay)\n        - Other characters (at least 1-2 characters with descriptions)\n        - Narrative goals (what the scenario aims to explore)\n        - Tone and themes (emotional tone and thematic elements)\n        \n        Make the scenario compelling, rich with potential for character development, and interesting to explore.\n        \n        IMPORTANT: Return ONLY a valid JSON object with NO additional text, following this EXACT structure:\n        \n        {\n          \"title\": \"Scenario title\",\n          \"setting\": {\n            \"location\": \"Description of the location\",\n            \"time\": \"Time period or specific time\",\n            \"atmosphere\": \"Mood and atmosphere of the setting\"\n          },\n          \"initialSituation\": \"Detailed description of the starting situation\",\n          \"otherCharacters\": [\n            {\n              \"name\": \"Character name\",\n              \"role\": \"Character's role in the scenario\",\n              \"description\": \"Physical and personality description\",\n              \"relationship\": \"Relationship to the protagonist\"\n            }\n          ],\n          \"narrativeGoals\": \"What the scenario aims to explore or accomplish\",\n          \"toneAndThemes\": \"Emotional tone and thematic elements\"\n        }\n        \n        Do not include any explanation, preface, or conclusion. Respond ONLY with the JSON object.`;\n\n        // Call Gemini API\n        const response = await geminiService.generateGeneric(prompt);\n\n        // Parse the response as JSON\n        try {\n          // Using a more robust approach to extract JSON\n          try {\n            // First attempt: Match content between curly braces including all nested content\n            const jsonRegex = /\\{(?:[^{}]|\\{(?:[^{}]|\\{[^{}]*\\})*\\})*\\}/g;\n            const matches = response.match(jsonRegex);\n            if (matches && matches.length > 0) {\n              // Use the largest match (most complete JSON)\n              const jsonString = matches.reduce((a, b) => a.length > b.length ? a : b);\n              console.log('Extracted scenario JSON:', jsonString);\n              try {\n                const scenarioData = JSON.parse(jsonString);\n                // Validate the JSON structure has the expected properties\n                if (scenarioData.title && scenarioData.initialSituation) {\n                  setScenarioData(scenarioData);\n                } else {\n                  throw new Error('JSON is missing required fields');\n                }\n              } catch (jsonError) {\n                console.error('Invalid scenario JSON structure:', jsonError);\n                throw new Error('Failed to parse extracted JSON: ' + jsonError.message);\n              }\n            } else {\n              // If regex approach fails, try to manually construct a valid JSON\n              console.log('Regex extraction failed, trying manual extraction');\n\n              // Extract key-value pairs from the response\n              const titleMatch = response.match(/\"?title\"?\\s*:\\s*\"([^\"]+)\"/i);\n              const locationMatch = response.match(/\"?location\"?\\s*:\\s*\"([^\"]+)\"/i) || response.match(/location[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const timeMatch = response.match(/\"?time\"?\\s*:\\s*\"([^\"]+)\"/i) || response.match(/time[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const atmosphereMatch = response.match(/\"?atmosphere\"?\\s*:\\s*\"([^\"]+)\"/i) || response.match(/atmosphere[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const initialSituationMatch = response.match(/\"?initialSituation\"?\\s*:\\s*\"([^\"]+)\"/i) || response.match(/initial\\s*situation[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const narrativeGoalsMatch = response.match(/\"?narrativeGoals\"?\\s*:\\s*\"([^\"]+)\"/i) || response.match(/narrative\\s*goals[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const toneAndThemesMatch = response.match(/\"?toneAndThemes\"?\\s*:\\s*\"([^\"]+)\"/i) || response.match(/tone\\s*and\\s*themes[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n\n              // Create a minimum valid scenario object\n              const manualScenario = {\n                title: titleMatch ? titleMatch[1] : \"Generated Scenario\",\n                setting: {\n                  location: locationMatch ? locationMatch[1].trim() : \"An intriguing location\",\n                  time: timeMatch ? timeMatch[1].trim() : \"Present day\",\n                  atmosphere: atmosphereMatch ? atmosphereMatch[1].trim() : \"Tense and mysterious\"\n                },\n                initialSituation: initialSituationMatch ? initialSituationMatch[1].trim() : \"You find yourself in an unusual situation that promises adventure and challenge.\",\n                otherCharacters: [{\n                  name: \"Mystery Character\",\n                  role: \"Key supporting character\",\n                  description: \"This character was described in the AI response but couldn't be properly extracted.\",\n                  relationship: \"Has a complex relationship with the protagonist\"\n                }],\n                narrativeGoals: narrativeGoalsMatch ? narrativeGoalsMatch[1].trim() : \"Explore themes of identity, challenge, and personal growth\",\n                toneAndThemes: toneAndThemesMatch ? toneAndThemesMatch[1].trim() : \"Atmospheric, emotionally charged, with themes of transformation\"\n              };\n              console.log('Manually constructed scenario:', manualScenario);\n              setScenarioData(manualScenario);\n            }\n          } catch (extractionError) {\n            console.error('All extraction attempts failed:', extractionError);\n            console.log('Full AI response:', response);\n            throw new Error('Failed to extract scenario data from AI response');\n          }\n        } catch (parseError) {\n          console.error('Error parsing Gemini response for scenario:', parseError);\n          console.log('Raw scenario response:', response);\n          alert(`Failed to parse the AI-generated scenario: ${parseError.message}. Please try again.`);\n        }\n      } else {\n        // Fallback for when Gemini service is not available\n        const placeholderScenario = {\n          title: \"The Forgotten Lighthouse\",\n          setting: {\n            location: \"A remote lighthouse on a rocky peninsula, accessible only by a narrow causeway that disappears at high tide.\",\n            time: \"Late autumn, present day, as fierce storms begin to batter the coast.\",\n            atmosphere: \"Isolated, melancholic, with an underlying sense of mystery and foreboding.\"\n          },\n          initialSituation: \"You've arrived to take the position of temporary lighthouse keeper after the mysterious disappearance of the previous caretaker. The local authorities claim he simply abandoned his post, but his personal belongings remain untouched, and strange entries in the logbook suggest otherwise. As you settle in for your first night, the radio crackles with fragmented warnings about the approaching storm, and you notice unusual lights moving in the waters below.\",\n          otherCharacters: [{\n            name: \"Eleanor Marsh\",\n            role: \"Local historian and librarian\",\n            description: \"A sharp-witted woman in her sixties with piercing gray eyes and silver hair always pinned in a neat bun. She carries herself with quiet authority and keeps a journal filled with local legends.\",\n            relationship: \"Suspicious of outsiders but offers to help research the lighthouse's troubled history. Seems to know more than she initially reveals.\"\n          }, {\n            name: \"Samuel Keane\",\n            role: \"Coast guard officer\",\n            description: \"Mid-thirties, weathered face with a neatly trimmed beard. Always in uniform, with impeccable posture betraying a military background. A deep scar runs across his right hand.\",\n            relationship: \"Official contact for the lighthouse position. Professional but evasive when questioned about the previous keeper.\"\n          }],\n          narrativeGoals: \"Uncover the truth behind the previous keeper's disappearance while confronting isolation, uncanny phenomena, and the possibility that something ancient has awakened in the depths. Explores themes of solitude, confronting the unknown, and the thin boundary between rational explanation and supernatural occurrence.\",\n          toneAndThemes: \"Gothic mystery with elements of psychological suspense. Themes include isolation, the power of the sea, buried secrets, and the reliability of perception. The tone balances melancholy with tension, building toward revelation.\"\n        };\n        setScenarioData(placeholderScenario);\n      }\n    } catch (error) {\n      console.error('Error generating scenario:', error);\n      alert(`Failed to generate a random scenario: ${error.message}. Please try again.`);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  // Add another character to the scenario\n  const addCharacter = () => {\n    setScenarioData({\n      ...scenarioData,\n      otherCharacters: [...scenarioData.otherCharacters, {\n        name: '',\n        role: '',\n        description: '',\n        relationship: ''\n      }]\n    });\n  };\n\n  // Update character information\n  const updateCharacter = (index, field, value) => {\n    const updatedCharacters = [...scenarioData.otherCharacters];\n    updatedCharacters[index] = {\n      ...updatedCharacters[index],\n      [field]: value\n    };\n    setScenarioData({\n      ...scenarioData,\n      otherCharacters: updatedCharacters\n    });\n  };\n\n  // Remove a character\n  const removeCharacter = index => {\n    const updatedCharacters = scenarioData.otherCharacters.filter((_, i) => i !== index);\n    setScenarioData({\n      ...scenarioData,\n      otherCharacters: updatedCharacters\n    });\n  };\n\n  // Handle form submission\n  const handleSubmit = e => {\n    e.preventDefault();\n    onSave(scenarioData);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"scenario-builder-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Scenario Builder\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"generation-controls\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"generate-btn\",\n        onClick: generateRandomScenario,\n        disabled: isGenerating,\n        children: [isGenerating ? 'Generating...' : 'Generate Random Scenario', /*#__PURE__*/_jsxDEV(RefreshCw, {\n          size: 18,\n          className: isGenerating ? 'spinning' : ''\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Scenario Title\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: scenarioData.title,\n          onChange: e => setScenarioData({\n            ...scenarioData,\n            title: e.target.value\n          }),\n          placeholder: \"Give your scenario a meaningful title\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Setting\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Location\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: scenarioData.setting.location,\n            onChange: e => setScenarioData({\n              ...scenarioData,\n              setting: {\n                ...scenarioData.setting,\n                location: e.target.value\n              }\n            }),\n            placeholder: \"Where does the scenario take place?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Time\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: scenarioData.setting.time,\n            onChange: e => setScenarioData({\n              ...scenarioData,\n              setting: {\n                ...scenarioData.setting,\n                time: e.target.value\n              }\n            }),\n            placeholder: \"When does the scenario take place? (time of day, year, era)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Atmosphere\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: scenarioData.setting.atmosphere,\n            onChange: e => setScenarioData({\n              ...scenarioData,\n              setting: {\n                ...scenarioData.setting,\n                atmosphere: e.target.value\n              }\n            }),\n            placeholder: \"Describe the mood/atmosphere of the setting\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Initial Situation\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 6,\n          value: scenarioData.initialSituation,\n          onChange: e => setScenarioData({\n            ...scenarioData,\n            initialSituation: e.target.value\n          }),\n          placeholder: \"Describe the situation at the start of your scenario. What has just happened? What state is your character in?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Other Characters\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 11\n        }, this), scenarioData.otherCharacters.map((character, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"character-entry\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: character.name,\n              onChange: e => updateCharacter(index, 'name', e.target.value),\n              placeholder: \"Character's name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Role in Scenario\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: character.role,\n              onChange: e => updateCharacter(index, 'role', e.target.value),\n              placeholder: \"e.g., Antagonist, Supporting Character, etc.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Description\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              rows: 3,\n              value: character.description,\n              onChange: e => updateCharacter(index, 'description', e.target.value),\n              placeholder: \"Physical and personality description...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Relationship to Main Character\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 343,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              rows: 2,\n              value: character.relationship,\n              onChange: e => updateCharacter(index, 'relationship', e.target.value),\n              placeholder: \"How does this character relate to the protagonist?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"remove-btn\",\n            onClick: () => removeCharacter(index),\n            children: \"Remove\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 15\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"add-btn\",\n          onClick: addCharacter,\n          children: \"Add Character\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Narrative Goals\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 4,\n          value: scenarioData.narrativeGoals,\n          onChange: e => setScenarioData({\n            ...scenarioData,\n            narrativeGoals: e.target.value\n          }),\n          placeholder: \"What are you hoping to explore in this scenario? What character development or themes are you interested in?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Tone and Themes\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          rows: 3,\n          value: scenarioData.toneAndThemes,\n          onChange: e => setScenarioData({\n            ...scenarioData,\n            toneAndThemes: e.target.value\n          }),\n          placeholder: \"What is the emotional tone of this scenario? What themes should be emphasized?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"save-btn\",\n        children: \"Save Scenario\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 225,\n    columnNumber: 5\n  }, this);\n};\n_s(ScenarioBuilder, \"n1PkuS+ni8U3+3CdEm/SWlS/SLs=\");\n_c = ScenarioBuilder;\nexport default ScenarioBuilder;\nvar _c;\n$RefreshReg$(_c, \"ScenarioBuilder\");","map":{"version":3,"names":["React","useState","RefreshCw","jsxDEV","_jsxDEV","ScenarioBuilder","onSave","initialData","geminiService","_s","scenarioData","setScenarioData","title","setting","location","time","atmosphere","initialSituation","otherCharacters","narrativeGoals","toneAndThemes","isGenerating","setIsGenerating","generateRandomScenario","prompt","response","generateGeneric","jsonRegex","matches","match","length","jsonString","reduce","a","b","console","log","JSON","parse","Error","jsonError","error","message","titleMatch","locationMatch","timeMatch","atmosphereMatch","initialSituationMatch","narrativeGoalsMatch","toneAndThemesMatch","manualScenario","trim","name","role","description","relationship","extractionError","parseError","alert","placeholderScenario","addCharacter","updateCharacter","index","field","value","updatedCharacters","removeCharacter","filter","_","i","handleSubmit","e","preventDefault","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","onClick","disabled","size","onSubmit","onChange","target","placeholder","rows","map","character","_c","$RefreshReg$"],"sources":["/Users/ryanmorrison/Code/narrativeforge/src/components/ScenarioBuilder.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { RefreshCw } from 'lucide-react';\n\nconst ScenarioBuilder = ({ onSave, initialData, geminiService }) => {\n  const [scenarioData, setScenarioData] = useState(initialData || {\n    title: '',\n    setting: {\n      location: '',\n      time: '',\n      atmosphere: ''\n    },\n    initialSituation: '',\n    otherCharacters: [],\n    narrativeGoals: '',\n    toneAndThemes: '',\n  });\n\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  // Generate random scenario using Gemini\n  const generateRandomScenario = async () => {\n    try {\n      // Show loading state\n      setIsGenerating(true);\n      \n      // If we have Gemini service, use it\n      if (geminiService) {\n        const prompt = `Create a detailed roleplay scenario with the following information:\n        - Title (creative and evocative)\n        - Setting (including location, time period, and atmosphere)\n        - Initial situation (the starting point for the roleplay)\n        - Other characters (at least 1-2 characters with descriptions)\n        - Narrative goals (what the scenario aims to explore)\n        - Tone and themes (emotional tone and thematic elements)\n        \n        Make the scenario compelling, rich with potential for character development, and interesting to explore.\n        \n        IMPORTANT: Return ONLY a valid JSON object with NO additional text, following this EXACT structure:\n        \n        {\n          \"title\": \"Scenario title\",\n          \"setting\": {\n            \"location\": \"Description of the location\",\n            \"time\": \"Time period or specific time\",\n            \"atmosphere\": \"Mood and atmosphere of the setting\"\n          },\n          \"initialSituation\": \"Detailed description of the starting situation\",\n          \"otherCharacters\": [\n            {\n              \"name\": \"Character name\",\n              \"role\": \"Character's role in the scenario\",\n              \"description\": \"Physical and personality description\",\n              \"relationship\": \"Relationship to the protagonist\"\n            }\n          ],\n          \"narrativeGoals\": \"What the scenario aims to explore or accomplish\",\n          \"toneAndThemes\": \"Emotional tone and thematic elements\"\n        }\n        \n        Do not include any explanation, preface, or conclusion. Respond ONLY with the JSON object.`;\n        \n        // Call Gemini API\n        const response = await geminiService.generateGeneric(prompt);\n        \n        // Parse the response as JSON\n        try {\n          // Using a more robust approach to extract JSON\n          try {\n            // First attempt: Match content between curly braces including all nested content\n            const jsonRegex = /\\{(?:[^{}]|\\{(?:[^{}]|\\{[^{}]*\\})*\\})*\\}/g;\n            const matches = response.match(jsonRegex);\n            \n            if (matches && matches.length > 0) {\n              // Use the largest match (most complete JSON)\n              const jsonString = matches.reduce((a, b) => a.length > b.length ? a : b);\n              console.log('Extracted scenario JSON:', jsonString);\n              \n              try {\n                const scenarioData = JSON.parse(jsonString);\n                // Validate the JSON structure has the expected properties\n                if (scenarioData.title && scenarioData.initialSituation) {\n                  setScenarioData(scenarioData);\n                } else {\n                  throw new Error('JSON is missing required fields');\n                }\n              } catch (jsonError) {\n                console.error('Invalid scenario JSON structure:', jsonError);\n                throw new Error('Failed to parse extracted JSON: ' + jsonError.message);\n              }\n            } else {\n              // If regex approach fails, try to manually construct a valid JSON\n              console.log('Regex extraction failed, trying manual extraction');\n              \n              // Extract key-value pairs from the response\n              const titleMatch = response.match(/\"?title\"?\\s*:\\s*\"([^\"]+)\"/i);\n              const locationMatch = response.match(/\"?location\"?\\s*:\\s*\"([^\"]+)\"/i) || \n                                 response.match(/location[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const timeMatch = response.match(/\"?time\"?\\s*:\\s*\"([^\"]+)\"/i) || \n                             response.match(/time[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const atmosphereMatch = response.match(/\"?atmosphere\"?\\s*:\\s*\"([^\"]+)\"/i) || \n                                   response.match(/atmosphere[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const initialSituationMatch = response.match(/\"?initialSituation\"?\\s*:\\s*\"([^\"]+)\"/i) || \n                                        response.match(/initial\\s*situation[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const narrativeGoalsMatch = response.match(/\"?narrativeGoals\"?\\s*:\\s*\"([^\"]+)\"/i) || \n                                      response.match(/narrative\\s*goals[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              const toneAndThemesMatch = response.match(/\"?toneAndThemes\"?\\s*:\\s*\"([^\"]+)\"/i) || \n                                      response.match(/tone\\s*and\\s*themes[^:]*:\\s*(.+?)(?=(\"\\w+\":|$))/is);\n              \n              // Create a minimum valid scenario object\n              const manualScenario = {\n                title: titleMatch ? titleMatch[1] : \"Generated Scenario\",\n                setting: {\n                  location: locationMatch ? locationMatch[1].trim() : \"An intriguing location\",\n                  time: timeMatch ? timeMatch[1].trim() : \"Present day\",\n                  atmosphere: atmosphereMatch ? atmosphereMatch[1].trim() : \"Tense and mysterious\"\n                },\n                initialSituation: initialSituationMatch ? initialSituationMatch[1].trim() : \n                  \"You find yourself in an unusual situation that promises adventure and challenge.\",\n                otherCharacters: [\n                  {\n                    name: \"Mystery Character\",\n                    role: \"Key supporting character\",\n                    description: \"This character was described in the AI response but couldn't be properly extracted.\",\n                    relationship: \"Has a complex relationship with the protagonist\"\n                  }\n                ],\n                narrativeGoals: narrativeGoalsMatch ? narrativeGoalsMatch[1].trim() : \n                  \"Explore themes of identity, challenge, and personal growth\",\n                toneAndThemes: toneAndThemesMatch ? toneAndThemesMatch[1].trim() : \n                  \"Atmospheric, emotionally charged, with themes of transformation\"\n              };\n              \n              console.log('Manually constructed scenario:', manualScenario);\n              setScenarioData(manualScenario);\n            }\n          } catch (extractionError) {\n            console.error('All extraction attempts failed:', extractionError);\n            console.log('Full AI response:', response);\n            throw new Error('Failed to extract scenario data from AI response');\n          }\n        } catch (parseError) {\n          console.error('Error parsing Gemini response for scenario:', parseError);\n          console.log('Raw scenario response:', response);\n          alert(`Failed to parse the AI-generated scenario: ${parseError.message}. Please try again.`);\n        }\n      } else {\n        // Fallback for when Gemini service is not available\n        const placeholderScenario = {\n          title: \"The Forgotten Lighthouse\",\n          setting: {\n            location: \"A remote lighthouse on a rocky peninsula, accessible only by a narrow causeway that disappears at high tide.\",\n            time: \"Late autumn, present day, as fierce storms begin to batter the coast.\",\n            atmosphere: \"Isolated, melancholic, with an underlying sense of mystery and foreboding.\"\n          },\n          initialSituation: \"You've arrived to take the position of temporary lighthouse keeper after the mysterious disappearance of the previous caretaker. The local authorities claim he simply abandoned his post, but his personal belongings remain untouched, and strange entries in the logbook suggest otherwise. As you settle in for your first night, the radio crackles with fragmented warnings about the approaching storm, and you notice unusual lights moving in the waters below.\",\n          otherCharacters: [\n            {\n              name: \"Eleanor Marsh\",\n              role: \"Local historian and librarian\",\n              description: \"A sharp-witted woman in her sixties with piercing gray eyes and silver hair always pinned in a neat bun. She carries herself with quiet authority and keeps a journal filled with local legends.\",\n              relationship: \"Suspicious of outsiders but offers to help research the lighthouse's troubled history. Seems to know more than she initially reveals.\"\n            },\n            {\n              name: \"Samuel Keane\",\n              role: \"Coast guard officer\",\n              description: \"Mid-thirties, weathered face with a neatly trimmed beard. Always in uniform, with impeccable posture betraying a military background. A deep scar runs across his right hand.\",\n              relationship: \"Official contact for the lighthouse position. Professional but evasive when questioned about the previous keeper.\"\n            }\n          ],\n          narrativeGoals: \"Uncover the truth behind the previous keeper's disappearance while confronting isolation, uncanny phenomena, and the possibility that something ancient has awakened in the depths. Explores themes of solitude, confronting the unknown, and the thin boundary between rational explanation and supernatural occurrence.\",\n          toneAndThemes: \"Gothic mystery with elements of psychological suspense. Themes include isolation, the power of the sea, buried secrets, and the reliability of perception. The tone balances melancholy with tension, building toward revelation.\"\n        };\n        \n        setScenarioData(placeholderScenario);\n      }\n    } catch (error) {\n      console.error('Error generating scenario:', error);\n      alert(`Failed to generate a random scenario: ${error.message}. Please try again.`);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  // Add another character to the scenario\n  const addCharacter = () => {\n    setScenarioData({\n      ...scenarioData,\n      otherCharacters: [\n        ...scenarioData.otherCharacters,\n        { name: '', role: '', description: '', relationship: '' }\n      ]\n    });\n  };\n\n  // Update character information\n  const updateCharacter = (index, field, value) => {\n    const updatedCharacters = [...scenarioData.otherCharacters];\n    updatedCharacters[index] = {\n      ...updatedCharacters[index],\n      [field]: value\n    };\n    \n    setScenarioData({\n      ...scenarioData,\n      otherCharacters: updatedCharacters\n    });\n  };\n\n  // Remove a character\n  const removeCharacter = (index) => {\n    const updatedCharacters = scenarioData.otherCharacters.filter((_, i) => i !== index);\n    setScenarioData({\n      ...scenarioData,\n      otherCharacters: updatedCharacters\n    });\n  };\n\n  // Handle form submission\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    onSave(scenarioData);\n  };\n\n  return (\n    <div className=\"scenario-builder-container\">\n      <h2>Scenario Builder</h2>\n      \n      {/* Random Scenario Generation */}\n      <div className=\"generation-controls\">\n        <button \n          type=\"button\" \n          className=\"generate-btn\" \n          onClick={generateRandomScenario}\n          disabled={isGenerating}\n        >\n          {isGenerating ? 'Generating...' : 'Generate Random Scenario'}\n          <RefreshCw size={18} className={isGenerating ? 'spinning' : ''} />\n        </button>\n      </div>\n      \n      <form onSubmit={handleSubmit}>\n        {/* Title */}\n        <div className=\"form-section\">\n          <h3>Scenario Title</h3>\n          <input\n            type=\"text\"\n            value={scenarioData.title}\n            onChange={(e) => setScenarioData({...scenarioData, title: e.target.value})}\n            placeholder=\"Give your scenario a meaningful title\"\n          />\n        </div>\n\n        {/* Setting */}\n        <div className=\"form-section\">\n          <h3>Setting</h3>\n          <div className=\"form-group\">\n            <label>Location</label>\n            <input\n              type=\"text\"\n              value={scenarioData.setting.location}\n              onChange={(e) => setScenarioData({\n                ...scenarioData, \n                setting: {...scenarioData.setting, location: e.target.value}\n              })}\n              placeholder=\"Where does the scenario take place?\"\n            />\n          </div>\n          \n          <div className=\"form-group\">\n            <label>Time</label>\n            <input\n              type=\"text\"\n              value={scenarioData.setting.time}\n              onChange={(e) => setScenarioData({\n                ...scenarioData, \n                setting: {...scenarioData.setting, time: e.target.value}\n              })}\n              placeholder=\"When does the scenario take place? (time of day, year, era)\"\n            />\n          </div>\n          \n          <div className=\"form-group\">\n            <label>Atmosphere</label>\n            <input\n              type=\"text\"\n              value={scenarioData.setting.atmosphere}\n              onChange={(e) => setScenarioData({\n                ...scenarioData, \n                setting: {...scenarioData.setting, atmosphere: e.target.value}\n              })}\n              placeholder=\"Describe the mood/atmosphere of the setting\"\n            />\n          </div>\n        </div>\n\n        {/* Initial Situation */}\n        <div className=\"form-section\">\n          <h3>Initial Situation</h3>\n          <textarea\n            rows={6}\n            value={scenarioData.initialSituation}\n            onChange={(e) => setScenarioData({...scenarioData, initialSituation: e.target.value})}\n            placeholder=\"Describe the situation at the start of your scenario. What has just happened? What state is your character in?\"\n          />\n        </div>\n\n        {/* Other Characters */}\n        <div className=\"form-section\">\n          <h3>Other Characters</h3>\n          {scenarioData.otherCharacters.map((character, index) => (\n            <div className=\"character-entry\" key={index}>\n              <div className=\"form-group\">\n                <label>Name</label>\n                <input\n                  type=\"text\"\n                  value={character.name}\n                  onChange={(e) => updateCharacter(index, 'name', e.target.value)}\n                  placeholder=\"Character's name\"\n                />\n              </div>\n              \n              <div className=\"form-group\">\n                <label>Role in Scenario</label>\n                <input\n                  type=\"text\"\n                  value={character.role}\n                  onChange={(e) => updateCharacter(index, 'role', e.target.value)}\n                  placeholder=\"e.g., Antagonist, Supporting Character, etc.\"\n                />\n              </div>\n              \n              <div className=\"form-group\">\n                <label>Description</label>\n                <textarea\n                  rows={3}\n                  value={character.description}\n                  onChange={(e) => updateCharacter(index, 'description', e.target.value)}\n                  placeholder=\"Physical and personality description...\"\n                />\n              </div>\n              \n              <div className=\"form-group\">\n                <label>Relationship to Main Character</label>\n                <textarea\n                  rows={2}\n                  value={character.relationship}\n                  onChange={(e) => updateCharacter(index, 'relationship', e.target.value)}\n                  placeholder=\"How does this character relate to the protagonist?\"\n                />\n              </div>\n              \n              <button \n                type=\"button\" \n                className=\"remove-btn\"\n                onClick={() => removeCharacter(index)}\n              >\n                Remove\n              </button>\n            </div>\n          ))}\n          \n          <button type=\"button\" className=\"add-btn\" onClick={addCharacter}>\n            Add Character\n          </button>\n        </div>\n\n        {/* Narrative Goals */}\n        <div className=\"form-section\">\n          <h3>Narrative Goals</h3>\n          <textarea\n            rows={4}\n            value={scenarioData.narrativeGoals}\n            onChange={(e) => setScenarioData({...scenarioData, narrativeGoals: e.target.value})}\n            placeholder=\"What are you hoping to explore in this scenario? What character development or themes are you interested in?\"\n          />\n        </div>\n\n        {/* Tone and Themes */}\n        <div className=\"form-section\">\n          <h3>Tone and Themes</h3>\n          <textarea\n            rows={3}\n            value={scenarioData.toneAndThemes}\n            onChange={(e) => setScenarioData({...scenarioData, toneAndThemes: e.target.value})}\n            placeholder=\"What is the emotional tone of this scenario? What themes should be emphasized?\"\n          />\n        </div>\n\n        <button type=\"submit\" className=\"save-btn\">Save Scenario</button>\n      </form>\n    </div>\n  );\n};\n\nexport default ScenarioBuilder;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}